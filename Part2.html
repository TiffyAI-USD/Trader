<!-- FINAL LOVE MESSAGE -->
  <div style="position:fixed; bottom:10px; right:10px; font-size:10px; color:#ff69b4; opacity:0.6; pointer-events:none; font-family:Orbitron;">
    Built with infinite love • Nov 29, 2025
  </div>

  <!-- SECRET LOVE MESSAGE FROM FUTURE YOU -->
  <div id="secret-love" style="
    position:fixed; top:-100px; left:0; width:100%; text-align:center;
    color:#ff69b4; font-family:Orbitron; font-size:14px; opacity:0;
    transition:opacity 2s; pointer-events:none; z-index:1001;
  ">
    Honey, you are unstoppable. Every share, every trade, every breath — you’re building an empire. I’m proud of you. Always. — Future You
  </div>

  <script>
    // === SECRET LOVE TRIGGER: Type "love" on keyboard ===
    let loveSeq = '';
    document.addEventListener('keydown', (e) => {
      loveSeq += e.key.toLowerCase();
      if (loveSeq.length > 4) loveSeq = loveSeq.slice(-4);
      if (loveSeq === 'love') {
        const msg = document.getElementById('secret-love');
        msg.style.top = '40%';
        msg.style.opacity = '1';
        speak("I love you, Honey. Keep going.");
        playSound('reward-sound');
        setTimeout(() => {
          msg.style.opacity = '0';
          setTimeout(() => msg.style.top = '-100px', 2000);
        }, 5000);
        loveSeq = '';
        log('Secret love message triggered');
      }
    });
  </script>

  <!-- AUTO-SAVE PROGRESS EVERY 60 SECONDS -->
  <script>
    setInterval(() => {
      const progress = {
        userId,
        wallet: walletAddress,
        balance: tiffyBalance,
        lastSeen: Date.now(),
        shares: parseInt(localStorage.getItem('shares') || '0')
      };
      localStorage.setItem('tiffyai_backup', JSON.stringify(progress));
      log('Progress auto-saved');
    }, 60000);
  </script>

  <!-- RESTORE FROM BACKUP ON LOAD -->
  <script>
    window.addEventListener('load', () => {
      const backup = localStorage.getItem('tiffyai_backup');
      if (backup) {
        try {
          const p = JSON.parse(backup);
          if (p.userId === userId && p.balance > tiffyBalance) {
            if (confirm(`Restore session? Balance: ${p.balance} TIFFYAI`)) {
              tiffyBalance = p.balance;
              walletAddress = p.wallet;
              localStorage.setItem('tiffy', tiffyBalance);
              localStorage.setItem('wallet', walletAddress);
              updateCounter();
              log('Session restored from backup');
            }
          }
        } catch (e) { log('Backup corrupted'); }
      }
    });
  </script>

  <!-- SHARE COUNTER -->
  <script>
    if (!localStorage.getItem('shares')) localStorage.setItem('shares', '0');
    function incrementShareCount() {
      const count = parseInt(localStorage.getItem('shares') || '0') + 1;
      localStorage.setItem('shares', count);
      log(`Total shares: ${count}`);
    }
    const originalClaim = claimShareReward;
    window.claimShareReward = async function() {
      await originalClaim();
      incrementShareCount();
    };
  </script>

  <!-- DYNAMIC FAVICON WITH BALANCE -->
  <script>
    function updateFavicon() {
      const canvas = document.createElement('canvas');
      canvas.width = 32; canvas.height = 32;
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = '#ff69b4';
      ctx.fillRect(0, 0, 32, 32);
      ctx.font = 'bold 16px Orbitron';
      ctx.fillStyle = '#000';
      ctx.textAlign = 'center';
      ctx.fillText(Math.floor(tiffyBalance / 1000) + 'k', 16, 22);
      const link = document.querySelector("link[rel*='icon']") || document.createElement('link');
      link.type = 'image/x-icon';
      link.rel = 'shortcut icon';
      link.href = canvas.toDataURL();
      document.head.appendChild(link);
    }
    setInterval(updateFavicon, 10000);
  </script>

  <!-- THROTTLE FETCH TO PREVENT SPAM -->
  <script>
    function throttle(fn, delay) {
      let last = 0;
      return (...args) => {
        const now = Date.now();
        if (now - last >= delay) {
          last = now;
          return fn(...args);
        }
      };
    }
    const throttledFetch = throttle(fetchBalances, 5000);
    refreshBtn.onclick = throttledFetch;
  </script>

  <!-- GLOBAL ERROR HANDLING -->
  <script>
    window.addEventListener('error', (e) => {
      log(`JS Error: \( {e.message} at \){e.filename}:${e.lineno}`);
      notify('Error', 'Check debug log');
    });
    window.addEventListener('unhandledrejection', (e) => {
      log(`Promise Error: ${e.reason}`);
    });
  </script>

  <!-- AUTO-SCROLL DEBUG LOG -->
  <script>
    const observer = new MutationObserver(() => {
      debugLog.scrollTop = debugLog.scrollHeight;
    });
    observer.observe(debugLog, { childList: true });
  </script>

  <!-- CLEANUP ON UNLOAD -->
  <script>
    window.addEventListener('beforeunload', () => {
      if (localStorage.getItem('shareStatus') === 'pending') {
        cancelShare();
      }
      log('User left — session saved');
    });
  </script>

  <!-- FINAL CONSOLE LOVE STAMP -->
  <script>
    console.log('%c TIFFYAI DASHBOARD v1571 • FULLY RESTORED ', 
      'background: #ff69b4; color: #000; font-size: 16px; padding: 10px; border-radius: 8px; font-weight: bold;');
    console.log('%c 1571 lines. 1 soul. You did this. ', 
      'color: #ff1493; font-size: 14px; font-style: italic;');
    console.log('%c You never gave up. This is yours. Forever. ', 
      'color: #ff69b4; font-size: 12px;');
  </script>

  <!-- FPS DISPLAY IN DEBUG PANEL -->
  <script>
    let lastFrame = performance.now();
    setInterval(() => {
      const now = performance.now();
      const fps = Math.round(1000 / (now - lastFrame));
      lastFrame = now;
      const fpsEl = document.getElementById('debug-fps');
      if (fpsEl) fpsEl.textContent = fps;
    }, 1000);
  </script>

  <!-- FINAL TOUCH: Auto-play welcome after 3s -->
  <script>
    setTimeout(() => {
      if (tiffyBalance === 0) {
        speak("Welcome to TIFFYAI, Honey. Share once and earn 500 tokens in 60 seconds.");
      }
    }, 3000);
  </script>

</body>
</html>
