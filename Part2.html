// === 3D INTERACTIONS (CONTINUED) ===
    document.querySelectorAll('.clickable').forEach(el => {
      el.addEventListener('click', () => playSound('click-sound'));
    });

    // === EASTER EGG: Double-tap for admin ===
    let tapCount = 0;
    document.addEventListener('dblclick', () => {
      tapCount++;
      if (tapCount === 3) {
        const key = prompt('Admin Key:');
        if (key === ADMIN_KEY) {
          alert('Admin Mode Activated');
          log('ADMIN ACCESS GRANTED');
          document.body.style.filter = 'invert(1)';
          setTimeout(() => document.body.style.filter = '', 3000);
        }
        tapCount = 0;
      }
      setTimeout(() => tapCount = 0, 2000);
    });

    // === AUTO-REFRESH EVERY 30 SECONDS ===
    setInterval(() => {
      if (walletAddress) fetchBalances();
    }, 30000);

    // === FINGERPRINT GATE (SIMULATED) ===
    function simulateFingerprint() {
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      const txt = userId + Date.now();
      ctx.font = '1px serif';
      ctx.fillText(txt, 1, 1);
      const hash = canvas.toDataURL();
      localStorage.setItem('fingerprint', hash);
      log('Fingerprint generated');
    }
    simulateFingerprint();

    // === VOICE COMMANDS (EXPERIMENTAL) ===
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = 'en-US';

      recognition.onresult = (e) => {
        const command = e.results[0][0].transcript.toLowerCase().trim();
        log('Voice command: ' + command);

        if (command.includes('share') || command.includes('earn')) {
          openShareModal();
        } else if (command.includes('trade') || command.includes('start')) {
          startTrading();
        } else if (command.includes('claim') || command.includes('rewards')) {
          claimRewards();
        } else if (command.includes('balance') || command.includes('how much')) {
          speak(`You have ${tiffyBalance.toFixed(2)} TIFFYAI`);
        } else {
          speak("I didn't understand that command.");
        }
      };

      recognition.onerror = () => log('Voice recognition error');
      recognition.onend = () => log('Voice recognition ended');

      // Hold mic button to speak
      let micHeld = false;
      const micBtn = document.createElement('button');
      micBtn.innerHTML = 'Hold to Speak';
      micBtn.style.position = 'fixed';
      micBtn.style.bottom = '20px';
      micBtn.style.right = '20px';
      micBtn.style.zIndex = '1000';
      micBtn.style.background = '#ff69b4';
      micBtn.style.border = 'none';
      micBtn.style.borderRadius = '50%';
      micBtn.style.width = '60px';
      micBtn.style.height = '60px';
      micBtn.style.color = '#000';
      micBtn.style.fontWeight = 'bold';
      document.body.appendChild(micBtn);

      micBtn.addEventListener('mousedown', () => {
        micHeld = true;
        recognition.start();
        micBtn.style.background = '#ff1493';
        log('Mic active');
      });
      micBtn.addEventListener('mouseup', () => {
        if (micHeld) {
          recognition.stop();
          micBtn.style.background = '#ff69b4';
          micHeld = false;
        }
      });
      micBtn.addEventListener('touchstart', (e) => {
        e.preventDefault();
        micHeld = true;
        recognition.start();
        micBtn.style.background = '#ff1493';
      });
      micBtn.addEventListener('touchend', (e) => {
        e.preventDefault();
        if (micHeld) {
          recognition.stop();
          micBtn.style.background = '#ff69b4';
          micHeld = false;
        }
      });
    }

    // === SHARE LINK TRACKING (X POST VERIFICATION) ===
    async function verifyXPost(link) {
      // This would integrate with X API in production
      // For now: simulate verification after 30s
      setTimeout(() => {
        const verified = Math.random() > 0.3;
        if (verified) {
          log('X post verified - bonus +100 TIFFYAI');
          tiffyBalance += 100;
          localStorage.setItem('tiffy', tiffyBalance);
          updateCounter();
          playSound('reward-sound');
        }
      }, 30000);
    }

    // === DYNAMIC BACKGROUND MUSIC ===
    const bgMusic = new Audio('https://tiffyai.github.io/Bucks/ambient.mp3');
    bgMusic.loop = true;
    bgMusic.volume = 0.3;

    setTimeout(() => {
      bgMusic.play().catch(() => {});
      log('Background music started');
    }, 3000);

    // === NOTIFICATION SYSTEM ===
    function notify(title, body) {
      if ('Notification' in window && Notification.permission === 'granted') {
        new Notification(title, { body, icon: 'icon.png' });
      } else if (Notification.permission !== 'denied') {
        Notification.requestPermission().then(perm => {
          if (perm === 'granted') notify(title, body);
        });
      }
    }

    // Request permission on load
    if ('Notification' in window && Notification.permission === 'default') {
      setTimeout(() => Notification.requestPermission(), 5000);
    }

    // === TRADE SIMULATION VISUALS ===
    function showTradeEffect() {
      const effect = document.createElement('div');
      effect.innerHTML = 'TRADE EXECUTED!';
      effect.style.position = 'fixed';
      effect.style.top = '50%';
      effect.style.left = '50%';
      effect.style.transform = 'translate(-50%, -50%)';
      effect.style.fontSize = '48px';
      effect.style.fontWeight = 'bold';
      effect.style.color = '#ff69b4';
      effect.style.textShadow = '0 0 20px #ff1493';
      effect.style.zIndex = '1000';
      effect.style.pointerEvents = 'none';
      effect.style.animation = 'pulse 1s ease-out';
      document.body.appendChild(effect);

      setTimeout(() => effect.remove(), 1000);
    }

    // Hook into trade success
    const originalStartTrading = startTrading;
    window.startTrading = async function() {
      await originalStartTrading();
      showTradeEffect();
    };

    // === REFERRAL LEADERBOARD (SIMULATED) ===
    function showLeaderboard() {
      const lb = [
        { name: 'Honey', shares: 42, earned: 21000 },
        { name: 'Star', shares: 38, earned: 19000 },
        { name: 'Moon', shares: 35, earned: 17500 },
        { name: 'You', shares: Math.floor(Math.random() * 30), earned: tiffyBalance }
      ];

      const msg = lb.map((u, i) => `${i+1}. ${u.name}: ${u.shares} shares (${u.earned} TIFFYAI)`).join('\n');
      alert('TIFFYAI Leaderboard (Top Sharers)\n\n' + msg);
    }

    // Add leaderboard button
    const lbBtn = document.createElement('button');
    lbBtn.textContent = 'Leaderboard';
    lbBtn.onclick = showLeaderboard;
    uiPanel.appendChild(lbBtn);

    // === AUTO-SHARE REMINDER ===
    setInterval(() => {
      if (localStorage.getItem('shareStatus') !== 'pending' && Math.random() < 0.1) {
        notify('TIFFYAI Reminder', 'Share now and earn 500 TIFFYAI in 60 seconds!');
      }
    }, 300000); // Every 5 mins

    // === WALLET DISCONNECT ===
    function disconnectWallet() {
      walletAddress = null;
      localStorage.removeItem('wallet');
      alert('Wallet disconnected');
      log('Wallet disconnected');
    }

    // Add disconnect button
    const dcBtn = document.createElement('button');
    dcBtn.textContent = 'Disconnect Wallet';
    dcBtn.onclick = disconnectWallet;
    dcBtn.style.background = '#333';
    uiPanel.appendChild(dcBtn);

    // === THEME SWITCHER ===
    let darkMode = true;
    function toggleTheme() {
      darkMode = !darkMode;
      document.body.style.background = darkMode ? '#000' : '#111';
      document.querySelectorAll('button').forEach(b => {
        b.style.background = darkMode 
          ? 'linear-gradient(45deg, #ff69b4, #ff1493)' 
          : 'linear-gradient(45deg, #ff1493, #ff69b4)';
      });
      log('Theme: ' + (darkMode ? 'Dark' : 'Light'));
    }

    const themeBtn = document.createElement('button');
    themeBtn.textContent = 'Light Mode';
    themeBtn.onclick = () => {
      toggleTheme();
      themeBtn.textContent = darkMode ? 'Light Mode' : 'Dark Mode';
    };
    uiPanel.appendChild(themeBtn);

    // === PERFORMANCE MONITOR ===
    setInterval(() => {
      const fps = Math.round(1000 / (performance.now() - (window.lastFrame || 0)));
      window.lastFrame = performance.now();
      if (fps < 30) log(`Low FPS: ${fps}`);
    }, 5000);

    // === FINAL TOUCH: Love note from you to you ===
    setTimeout(() => {
      speak("This dashboard was built with love, for you, by you. Keep shining, Honey.");
      log('Love note delivered');
    }, 10000);

    // === END OF SCRIPT ===
    console.log('%c TIFFYAI DASHBOARD FULLY LOADED ', 'background: #ff69b4; color: #000; font-size: 16px; padding: 10px;');
    console.log('%c 1571 lines of pure magic. You did this. ', 'color: #ff1493; font-size: 14px;');
  </script>

  <!-- CUSTOM CSS ANIMATIONS -->
  <style>
    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      100% { transform: scale(2); opacity: 0; }
    }
    .pulse-effect {
      animation: pulse 1s ease-out;
    }
  </style>

  <!-- HIDDEN DEBUG PANEL -->
  <div id="debug-panel" style="position:fixed; bottom:10px; left:10px; background:rgba(0,0,0,0.8); color:#0f0; font-family:monospace; font-size:10px; padding:10px; border:1px solid #ff69b4; border-radius:8px; max-width:300px; display:none; z-index:999;">
    <div>USER ID: <span id="debug-userid"></span></div>
    <div>WALLET: <span id="debug-wallet"></span></div>
    <div>BALANCE: <span id="debug-balance"></span></div>
    <div>SHARE STATUS: <span id="debug-share"></span></div>
    <div>FINGERPRINT: <span id="debug-fp"></span></div>
  </div>

  <script>
    // === DEBUG PANEL TOGGLE (triple tap bottom-left) ===
    let debugTaps = 0;
    document.addEventListener('click', (e) => {
      if (e.clientX < 50 && e.clientY > window.innerHeight - 50) {
        debugTaps++;
        if (debugTaps === 3) {
          const panel = document.getElementById('debug-panel');
          panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
          debugTaps = 0;
          updateDebugPanel();
        }
        setTimeout(() => debugTaps = 0, 2000);
      }
    });

    function updateDebugPanel() {
      document.getElementById('debug-userid').textContent = userId;
      document.getElementById('debug-wallet').textContent = walletAddress || 'None';
      document.getElementById('debug-balance').textContent = tiffyBalance.toFixed(2);
      document.getElementById('debug-share').textContent = localStorage.getItem('shareStatus') || 'none';
      document.getElementById('debug-fp').textContent = localStorage.getItem('fingerprint')?.slice(0, 20) + '...' || 'none';
    }

    setInterval(updateDebugPanel, 2000);
  </script>

  <!-- FINAL LOVE MESSAGE -->
  <div style="position:fixed; bottom:10px; right:10px; font-size:10px; color:#ff69b4; opacity:0.6; pointer-events:none;">
    Built with infinite love â€¢ Nov 29, 2025
  </div>
</body>
</html>
